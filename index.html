<html>
<head>
    <title>雪雉小店终极策略</title>
    <style>
        body {
            padding-top: 10px;
            padding-left: 10px;
            padding-right: 10px;
            color: #FFF;
            text-shadow: -2px -2px #000, -2px -1px #000, -2px 0 #000, -2px 1px #000, -2px 2px #000, -1px -2px #000, -1px -1px #000, -1px 0 #000, -1px 1px #000, -1px 2px #000, 0 -2px #000, 0 -1px #000, 0 0 #000, 0 1px #000, 0 2px #000, 1px -2px #000, 1px -1px #000, 1px 0 #000, 1px 1px #000, 1px 2px #000, 2px -2px #000, 2px -1px #000, 2px 0 #000, 2px 1px #000, 2px 2px #000;
            text-align: center;
        }

        #div_overlay_container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3044248;
            background-color: #000000EE;
        }

        .div_container {
            margin-top: 20px;
            margin-left: 20px;
            margin-right: 20px;
        }

        a:link, a:visited {
            color: #FFA500;
        }

        textarea {
            width: 100%;
            resize: none;
        }

        table {
            border-collapse: collapse;
        }

        .table_header {
            width: 100%;
            text-align: left;
            font-size: 1.5em;
            table-layout: fixed;
        }

        .table_header th {
            font-size: 1.6em;
        }

        .table_text {
            width: 100%;
            text-align: left;
            table-layout: fixed;
        }

        .table_text tr {
            height: 75px;
        }

        .table_text th {
            font-size: 2em;
            padding: 10px;
        }

        .table_text td {
            height: 20px;
            /* width: 50%; */
            font-size: 1.5em;
        }

        .table_text input {
            /* height: 75px; */
            width: 80%;
            /* font-size: 1.5em; */
        }

        .table_text select {
            width: 80%;
        }

        #L8 {
            font-size: 2em;
        }

        #L8 span {
            color: #FFA500;
        }

        #table_cost {
            color: #FFF;
        }

        #tr_warning {
            color: red;
        }

        td[id^="td_wish"], td[id^="td_cost"] {
            border-width: 1px;
            border-color: #AAAAAA;
            border-top-style: solid;
            border-bottom-style: solid;
            border-left-style: dashed;
            border-right-style: dashed;
            padding-left: 10px;
            padding-right: 10px;
        }

        #td_cost_result {
            border-width: 0px;
        }

        td[id^="td_cost"] span {
            color: #FFA500;
            margin-left: 5px;
            margin-right: 5px;
        }

        .tr_border_bottom {
            border-bottom: 1px solid #000;
        }

        .td_border_right {
            border-right: 1px solid #000;
        }

        td[class="td_cost_not_paid"] {
            background-color: #fedcba;
        }

        #div_wish_options {
            position:absolute;
            margin-top: 15px;
        }

        .div_button {
            background-color: #F0F0F07F;
            padding: 10px;
            border-radius: 3px;
            border-color: #000;
            border-style: solid;
            border-width: 1px;
            text-align: center;
        }

        .wish_option {
            background-color: #DDDDDD7F;
            height: 32px;
            padding: 3px 10px;
            margin-top: 2px;
            border-radius: 3px;
            border-style: solid;
            border-width: 1px;
            border-color: #000;
        }

        .div_button:hover, .wish_option:hover {
            background-color: #2B666666;
        }

        #tr_notice {
            background-color: #ffbf92;
        }

        #td_notice {
            width: 80%;
            padding-left: 10px;
        }

        #td_notice_button {
            width: 20%;
            padding-right: 10px;
            text-align: right;
        }

        .div_notice_button {
            width: 50px;
            display: inline-block;
            background-color: #F0F0F07F;
            padding: 10px;
            border-radius: 3px;
            border-color: #000;
            border-style: solid;
            border-width: 1px;
            text-align: center;
        }

        .div_tag_button, .div_settings_button {
            width: 150px;
            display: inline-block;
            background-color: #F0F0F07F;
            padding: 10px;
            border-radius: 3px;
            border-color: #000;
            border-style: solid;
            border-width: 1px;
            text-align: center;
        }

        .div_tag_button:hover {
            outline-color: #00AAFF;
            outline-style: solid;
            outline-width: 3px;
        }

        .aite_A {
            color: #8dd3f6;
        }

        .aite_B {
            color: #aee1bb;
        }


        .div_tag_button_enabled {
            background-color: #00AAFF;
        }

        .div_tag_button_enabled_useless {
            background-color: #bb5a5a;
        }

        .div_tag_button_disabled {
            background-color: #ebeb16;
        }

        .div_tag_button_disabled_useless {
            background-color: #76cb8b;
        }

        #td_md5 {
            text-align: center;
            opacity: 0;
        }

        #td_md5:hover {
            opacity: 1;
            background-color: #2B666666;
        }
    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QGM58QCD7C"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-QGM58QCD7C');
    </script>
</head>

<body>
    <table class="table_header">
        <tr>
            <th colspan="2">
                雪雉小店终极策略
            </th>
            <td>
                <div class="div_button">设置（暂时不可用）</div>
            </td>
            <td>
                <div class="div_button" onclick="location.reload();">清空（刷新）</div>
            </td>
        </tr>
    </table>
    <table class="table_text">
        <tr>
            <td colspan="4" id="td_notice_2">
                <a href="https://www.bilibili.com/video/BV11p4y1V78k" target="_blank">【全站唯一】精确计算，极致高产！深度解析雪雉小店，附带经营策略计算器</a> 出现BUG可以私信作者 QQ交流群951454445
            </td>
            <td colspan="1">
                <p>原作者：<a href="https://space.bilibili.com/246187036" target="_blank">他的十天Histensky</a></p>
            </td>
        </tr>
        <tr>
            <td colspan="4" class="">
                未打探时打探结果填0；注意看对手的图标，不要搞反两个对手的顺序，搞错顺序可能导致的收益损失需自行承担
            </td>
            <td colspan="1">
                <p>移　植：<a href="https://space.bilibili.com/533170" target="_blank">羽波</a></p>
            </td>
        </tr>
        <tr>
            <td colspan="4" class="">
                对于饮料和食物，单项的总进货量小于300时选择激进策略，大于等于300时选择稳健策略，大于1200时可选择保守策略
            </td>
            <td colspan="1" class="">
                <a href="./help.html">查看说明书</a>
            </td>
        </tr>
    </table>
    <table class="table_text" id="table_settings" style="display: none;">
        <tr>
            <th>这是设置</td>
        </tr>
        <tr>
            <td>饮品定价范围</td>
            <td><input type="number" id="drink_fw_0" min="0" value="95"></td>
            <td class="td_border_right"><input type="number" id="drink_fw_1" min="0" value="105"></td>
        </tr>
        <tr>
            <td>食品定价范围</td>
            <td><input type="number" id="food_fw_0" min="0" value="75"></td>
            <td class="td_border_right"><input type="number" id="food_fw_1" min="0" value="85"></td>
        </tr>
        <tr>
            <td>纪念品定价范围</td>
            <td><input type="number" id="toy_fw_0" min="0" value="950"></td>
            <td class="td_border_right"><input type="number" id="toy_fw_1" min="0" value="1050"></td>
        </tr>
        <tr>
            <td class="tr_border_bottom">销售名次奖励</td>
            <td class="tr_border_bottom"><input type="number" id="bonus_1" min="0" value="5000"></td>
            <td class="tr_border_bottom"><input type="number" id="bonus_2" min="0" value="2000"></td>
            <td class="tr_border_bottom td_border_right"><input type="number" id="bonus_3" min="0" value="1000"></td>
        </tr>
    </table>
    <table class="table_text" id="table_main">
        <tr class="tr_border_bottom">
            <td class="td_border_right"></td>
            <th colspan="4" class="td_border_right">
                采购策略
            </th>
            <th colspan="2" class="td_border_right">
                打探结果
            </th>
            <th colspan="2" class="">
                推荐定价和预计收益
            </th>
        </tr>
        <tr>
                <td class="td_border_right"></td>
                <td>总量</td>
                <td>你</td>
                <td class="aite_A">对手A</td>
                <td class="aite_B td_border_right">对手B</td>
                <td class="aite_A">对手A定价</td>
                <td class="aite_B td_border_right">对手B定价</td>
        </tr>
        <tr>
            <th class="td_border_right">饮品</th>
            <td><input type="number" id="drink_total" min="0" value="0"><br>　</td>
            <td>
                <select name="drink_strat_0" id="drink_strat_0">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="drink_stock_0">?</span>
            </td>
            <td>
                <select name="drink_strat_1" id="drink_strat_1">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="drink_stock_1">?</span>
            </td>
            <td class="td_border_right">
                <select name="drink_strat_2" id="drink_strat_2">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="drink_stock_2">?</span>
            </td>
            <td><input type="number" id="drink_dt_0" min="0" value="0"><br>　</td>
            <td class="td_border_right"><input type="number" id="drink_dt_1" min="0" value="0"><br>　</td>
            <td colspan="2" id="Le1"></td>
        </tr>
        <tr>
            <th class="td_border_right">食品</th>
            <td><input type="number" id="food_total" min="0" value="0"><br>　</td>
            <td>
                <select name="food_strat_0" id="food_strat_0">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="food_stock_0">?</span>
            </td>
            <td>
                <select name="food_strat_1" id="food_strat_1">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="food_stock_1">?</span>
            </td>
            <td class="td_border_right">
                <select name="food_strat_2" id="food_strat_2">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="food_stock_2">?</span>
            </td>
            <td><input type="number" id="food_dt_0" min="0" value="0"><br>　</td>
            <td class="td_border_right"><input type="number" id="food_dt_1" min="0" value="0"><br>　</td>
            <td colspan="2" id="Le2"></td>
        </tr>
        <tr class="tr_border_bottom">
            <th class="td_border_right">纪念品</th>
            <td><input type="number" id="toy_total" min="0" value="0"><br>　</td>
            <td>
                <select name="toy_strat_0" id="toy_strat_0">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="toy_stock_0">?</span>
            </td>
            <td>
                <select name="toy_strat_1" id="toy_strat_1">
                    <option value="-1">未知</option>
                    <option value="0">保守</option>
                    <option value="1">稳健</option>
                    <option value="2">激进</option>
                </select>
                <br>
                <span id="toy_stock_1">?</span>
            </td>
            <td class="td_border_right"></td>
            <td><input type="number" id="toy_dt_0" min="0" value="0"><br>　</td>
            <td class="td_border_right"></td>
            <td colspan="2" id="Le3"></td>
        </tr>
        <tr>
            <td style="font-size: 2em; font-weight: bold;">剩余打探次数</td>
            <td colspan="1" class=""><input type="number" id="detect" min="0" value="4"  style="font-size: 2em; font-weight: bold;"></td>
            <td></td>
            <td colspan="2" rowspan="1">
                <div class="div_button" onclick="first_phase_greedy();">贪心算法判断进货策略</div>
            </td>
            <td colspan="2" rowspan="1">
                <div class="div_button" onclick="cal_jinhuo();">计算进货数量并比对</div>
            </td>
            <td colspan="2" rowspan="1">
                <div class="div_button" onclick="calculate();">开始计算</div>
            </td>
        <tr class="tr_border_bottom">
            <td colspan="7" rowspan="1"></td>
            <td colspan="2" rowspan="1">
                <div class="div_button" onclick="reset_calc();">重置！</div>
            </td>
        </tr>
        <tr>
            <td colspan="8" id="L8">这里显示计算结果</td>
        </tr>
    </table>

    <script>
        let last_toggle = 0;
        let strattoint = {
            "激进": 2,
            "稳健": 1,
            "保守": 0,
            "": -1,
            3: "",
            2: "激进",
            1: "稳健",
            0: "保守",
        }
        let drink_buyin = [30, 42, 57]
        let food_buyin = [15, 30, 48]

        let N = 0
        let C = 0

        function sum(array) {
            return array.reduce((accumulator, currentValue) => {return accumulator + currentValue}, 0)
        }

        function rank(price_list, index) {
            let ret = 1
            for (let i = 0; i < price_list.length; i++) {
                if (price_list[i] < price_list[index]) {
                    ret += 1
                }
            }
            return ret
        }

        function percentages(price_list) {
            let ranks = [0, 0, 0]
            for (let i = 0; i < 3; i++) {
                ranks[i] = rank(price_list, i)
            }
            if (ranks.includes(2) && ranks.includes(3)) {
                for (let i = 0; i < 3; i++) {
                    ranks[i] = (5 - ranks[i]) / 9
                }
            }
            else if (ranks.includes(2) || ranks.includes(3)) {
                for (let i = 0; i < 3; i++) {
                    ranks[i] = (5 - ranks[i]) / 10
                }
            }
            else {
                for (let i = 0; i < 3; i++) {
                    ranks[i] = 1 / 3
                }
            }
            return ranks
        }

        function set_price(min_price, max_price, stocks, prices, bonus=[5000, 2000, 1000], print_result=0) {
            N++
            // if (N % 1000 == 0) console.log(N)
            if (prices[0] > 0) {
                // 已知全部价格，进行销量计算
                let market_percentage = percentages(prices)
                let sell_count = [0, 0, 0]
                let income = [0, 0, 0]
                let total_stock = sum(stocks)
                for (let i = 0; i < 3; i++) {
                    sell_count[i] = Math.min(stocks[i], total_stock * market_percentage[i])
                    income[i] = sell_count[i] * prices[i]
                }
                if (income[0] >= income[1] && income[0] >= income[2]) {
                    income[0] += bonus[0]
                }
                else if (income[0] >= income[1] || income[0] >= income[2]) {
                    income[0] += bonus[1]
                }
                else {
                    income[0] += bonus[2]
                }
                if (print_result) {
                    console.log(prices, sell_count, income[0])
                }
                return income[0]
            }
            else if (prices[1] > 0 && prices[2] > 0) {
                // 已知两个对手的定价，计算我方最佳定价
                let best_price = -1
                let best_benefit = -1
                let total_stock = sum(stocks)
                for (let price = min_price; price < 1 + max_price; price++) {
                    let actual_prices = prices.slice()
                    actual_prices[0] = price
                    let actual_income = set_price(min_price, max_price, stocks, actual_prices, bonus=bonus)
                    if (actual_income >= best_benefit) {
                        best_benefit = actual_income
                        best_price = price
                    }
                }
                return [
                    best_price,
                    best_benefit,
                    0,
                    0
                ]
            }
            else if (sum(prices) > 0) {
                // 仅已知一个对手定价，计算我方期望最佳定价和进一步探测收益
                let missing_place
                if (prices[1] > 0) {
                    missing_place = 2
                }
                else {
                    missing_place = 1
                }
                let max_income = 0
                let best_price = 0
                for (let my_price = min_price; my_price < 1 + max_price; my_price++) {
                    let sum_income = 0
                    for (let opponent_price = min_price; opponent_price < 1 + sum(prices); opponent_price++) {
                        let actual_prices = prices.slice()
                        actual_prices[0] = my_price
                        actual_prices[missing_place] = opponent_price
                        let got_income = set_price(min_price, max_price, stocks, actual_prices, bonus=bonus)
                        // 两个对手定价相同的概率是定价不同的概率的一半，因为定价不同的话有BA和AB两种情况，定价相同只有BB一种
                        if (opponent_price != sum(prices)) {
                            sum_income += got_income
                        }
                        else {
                            sum_income += got_income / 2
                        }
                    }
                    if (sum_income >= max_income) {
                        max_income = sum_income
                        best_price = my_price
                    }
                }

                let sum_income_while_detected = 0
                for (let opponent_price = min_price; opponent_price < 1 + sum(prices); opponent_price++) {
                    let actual_prices = prices.slice()
                    actual_prices[missing_place] = opponent_price
                    let this_income = set_price(min_price, max_price, stocks, actual_prices)
                    if (opponent_price != sum(prices)) {
                        sum_income_while_detected += this_income[1]
                    }
                    else {
                        sum_income_while_detected += this_income[1] / 2
                    }
                }
                // 因此总情况数量也要减去半个
                let average_income_while_detected = sum_income_while_detected / (sum(prices) + 1 - min_price - 0.5)
                let average_income_not_detected = max_income / (sum(prices) + 1 - min_price - 0.5)

                return [
                    best_price,
                    average_income_not_detected,
                    average_income_while_detected - average_income_not_detected,
                    0
                ]
            }
            else {
                // 对手定价完全未知，计算盲开最佳定价以及探测收益
                let total_income = 0
                let second_detect_benefit = 0
                let first_detect_benefit = 0
                let result1 = [], result2 = []
                for (let i = 0; i < 2 + max_price - min_price; i++) {
                    result1.push(0)
                    result2.push(0)
                }
                for (let price1 = min_price; price1 < 1 + max_price; price1++) {
                    let detected_price = [0, price1, 0]
                    result1[price1 - min_price] = set_price(min_price, max_price, stocks, detected_price, bonus=bonus)
                }
                for (let price2 = min_price; price2 < 1 + max_price; price2++) {
                    let detected_price = [0, 0, price2]
                    result2[price2 - min_price] = set_price(min_price, max_price, stocks, detected_price, bonus=bonus)
                }
                for (let price1 = min_price; price1 < 1 + max_price; price1++) {
                    for (let price2 = min_price; price2 < 1 + max_price; price2++) {
                        if (price1 > price2) {
                            second_detect_benefit += result1[price1 - min_price][2]
                            first_detect_benefit += result1[price1 - min_price][1]
                        }
                        else if (price2 > price1) {
                            second_detect_benefit += result2[price2 - min_price][2]
                            first_detect_benefit += result2[price2 - min_price][1]
                        }
                        else {
                            second_detect_benefit += (result1[price1 - min_price][2] + result2[price2 - min_price][2]) / 2
                            first_detect_benefit += (result1[price1 - min_price][1] + result2[price2 - min_price][1]) / 2
                        }
                    }
                }

                first_detect_benefit /= (max_price - min_price + 1) * (max_price - min_price + 1)
                let best_price = 0
                let max_benefit = 0
                for (let price0 = min_price; price0 < 1 + max_price; price0++) {
                    let benefit = 0
                    for (let price1 = min_price; price1 < 1 + max_price; price1++) {
                        for (let price2 = min_price; price2 < 1 + max_price; price2++) {
                            benefit += set_price(min_price, max_price, stocks, [price0, price1, price2], bonus=bonus)
                        }
                    }
                    if (benefit > max_benefit) {
                        max_benefit = benefit
                        best_price = price0
                    }
                }

                return [
                    best_price,
                    max_benefit / ((max_price - min_price + 1) ** 2),
                    Math.round(first_detect_benefit - max_benefit / ((max_price - min_price + 1) ** 2), 6),
                    second_detect_benefit / ((max_price - min_price) ** 2)
                ]
            }
        }

        function safe_int(s) {
            if (Array.isArray(s)){
                let ret = [];
                for (let i = 0; i < s.length; i) {
                    ret.push(parseInt(s) || 0);
                }
                return ret;
            }
            return parseInt(s) || 0;
        }

        function toy_benefit(min_price, max_price, stocks) {
            let orig_win, best_win, n
            if (stocks[0] == stocks[1]) {
                orig_win = stocks[0] * min_price
                best_win = 0
                n = 0
                for (let price2 = min_price; price2 < max_price + 10; price2 += 10) {
                    n += 1
                    best_win += stocks[0] * price2
                }
                best_win /= n
                return [best_win, orig_win]
            }
            else {
                orig_win = 0
                best_win = 0
                n = 0
                for (let price2 = min_price; price2 < max_price + 10; price2 += 10) {
                    n += 1
                    if (price2 != min_price) {
                        orig_win += stocks[0] * min_price
                        best_win += stocks[0] * (price2 - 10)
                    }
                    else {
                        orig_win += (stocks[0] + stocks[1]) / 2 * min_price
                        best_win += (stocks[0] + stocks[1]) / 2 * min_price
                    }
                }
                best_win /= n
                orig_win /= n
                return [best_win, orig_win]
            }
        }

        function best_strategy(s, t) {
            let ret = []
            for (let i = 0; i < s.length; i++) {
                ret.push(0)
            }
            if (t <= 0) {
                return [ret, 0]
            }
            let max = -99999
            for (let i = 0; i < s.length; i++) {
                let s2 = []
                for (let j = 0; j < s.length; j++) {
                    s2.push(s[j].slice())
                }
                if (s2[i].length > 0) {
                    let temp = s2[i][0]
                    s2[i] = s2[i].slice(1)
                    let new_strat = best_strategy(s2.slice(), t - 1)
                    if (new_strat[1] + temp > max) {
                        max = new_strat[1] + temp
                        ret = new_strat[0]
                        ret[i] += 1
                    }
                }
            }
            return [ret, max]
        }

        function calculate() {
            console.log('calculate()')
            let detect_time = safe_int(document.getElementById('detect').value)
            let minus, result
            let txt, txt_big = ''
            if (
                safe_int(document.getElementById('drink_fw_0').value) < 1 ||
                safe_int(document.getElementById('drink_fw_1').value) < 1 ||
                safe_int(document.getElementById('drink_fw_0').value) > safe_int(document.getElementById('drink_fw_1').value) ||
                safe_int(document.getElementById('food_fw_0').value) < 1 ||
                safe_int(document.getElementById('food_fw_1').value) < 1 ||
                safe_int(document.getElementById('food_fw_0').value) > safe_int(document.getElementById('food_fw_1').value) ||
                safe_int(document.getElementById('toy_fw_0').value) < 1 ||
                safe_int(document.getElementById('toy_fw_1').value) < 1 ||
                safe_int(document.getElementById('toy_fw_0').value) > safe_int(document.getElementById('toy_fw_1').value)
            ) {
                document.getElementById('L8').innerHTML = '数据异常，请检查定价是否填写错误'
                return
            }
            minus = -1
            if (detect_time <= 0) {
                if (!document.getElementById('Le1').innerHTML) {
                    let best = set_price(
                        min_price=safe_int(document.getElementById('drink_fw_0').value),
                        max_price=safe_int(document.getElementById('drink_fw_1').value),
                        stocks=[safe_int(document.getElementById('drink_stock_0').innerHTML), safe_int(document.getElementById('drink_stock_1').innerHTML), safe_int(document.getElementById('drink_stock_2').innerHTML)],
                        prices=[0, safe_int(document.getElementById('drink_dt_0').value), safe_int(document.getElementById('drink_dt_1').value)],
                        bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                    )
                    txt = `定价${best[0]}，预计收益为${best[1]}`
                    document.getElementById('Le1').innerHTML = txt
                }
                if (!document.getElementById('Le2').innerHTML) {
                    let best = set_price(
                        min_price=safe_int(document.getElementById('food_fw_0').value),
                        max_price=safe_int(document.getElementById('food_fw_1').value),
                        stocks=[safe_int(document.getElementById('food_stock_0').innerHTML), safe_int(document.getElementById('food_stock_1').innerHTML), safe_int(document.getElementById('food_stock_2').innerHTML)],
                        prices=[0, safe_int(document.getElementById('food_dt_0').value), safe_int(document.getElementById('food_dt_1').value)],
                        bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                    )
                    txt = `定价${best[0]}，预计收益为${best[1]}`
                    document.getElementById('Le2').innerHTML= txt
                }
                if (!document.getElementById('Le3').innerHTML) {
                    let min_price = safe_int(document.getElementById('toy_fw_0').value)
                    let max_price = safe_int(document.getElementById('toy_fw_1').value)
                    let stocks = [safe_int(document.getElementById('toy_stock_0').innerHTML), safe_int(document.getElementById('toy_stock_1').innerHTML)]
                    let bonus = [safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)]
                    let price = safe_int(document.getElementById('toy_dt_0').value)
                    if (price < min_price) {
                        result = toy_benefit(min_price, max_price, stocks)[1]
                        p = min_price
                    }
                    else {
                        if (price == min_price) {
                            result = (stocks[0] + stocks[1]) / 2 * min_price
                            p = min_price
                        }
                        else {
                            if (stocks[0] > stocks[1]) {
                                result = stocks[0] * (price - 10)
                                p = price - 10
                            }
                            else {
                                result = stocks[0] * price
                                p = price
                            }
                        }
                    }

                    result += bonus[0]
                    txt = `定价${p}，预计收益为${result}<br>若有积压纪念品，可以适当减价10抛售`
                    let best_drink = set_price(
                        min_price=safe_int(document.getElementById('drink_fw_0').value),
                        max_price=safe_int(document.getElementById('drink_fw_1').value),
                        stocks=[safe_int(document.getElementById('drink_stock_0').innerHTML), safe_int(document.getElementById('drink_stock_1').innerHTML),
                                safe_int(document.getElementById('drink_stock_2').innerHTML)],
                        prices=[0, safe_int(document.getElementById('drink_dt_0').value), safe_int(document.getElementById('drink_dt_1').value)],
                        bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                    )
                    let best_food = set_price(
                        min_price=safe_int(document.getElementById('food_fw_0').value),
                        max_price=safe_int(document.getElementById('food_fw_1').value),
                        stocks=[safe_int(document.getElementById('food_stock_0').innerHTML), safe_int(document.getElementById('food_stock_1').innerHTML), safe_int(document.getElementById('food_stock_2').innerHTML)],
                        prices=[0, safe_int(document.getElementById('food_dt_0').value), safe_int(document.getElementById('food_dt_1').value)],
                        bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                    )
                    let cost = 0
                    if (document.getElementById('drink_strat_0').value > -1 && document.getElementById('food_strat_0').value > -1 && document.getElementById('toy_strat_0').value > -1) {
                        st_drink = document.getElementById('drink_strat_0').value
                        st_food = document.getElementById('food_strat_0').value
                        st_toy = document.getElementById('toy_strat_0').value
                        if (st_drink >= 0 && st_food >= 0 && st_toy >= 0) {
                            let toy_buyin = [50, 100, 200]
                            cost += safe_int(drink_buyin[st_drink]) * safe_int(safe_int(document.getElementById('drink_stock_0').innerHTML))
                            cost += safe_int(food_buyin[st_food]) * safe_int(safe_int(document.getElementById('food_stock_0').innerHTML))
                            cost += safe_int(toy_buyin[st_toy]) * safe_int(safe_int(document.getElementById('toy_stock_0').innerHTML))
                        }
                    }
                    txt_big = `计算完成！享受你的收益吧！预期收益是${best_food[1] + best_drink[1] + result - cost}`
                    if (cost < 1) {
                        txt_big += "（没有计算成本）"
                    }
                    document.getElementById('Le3').innerHTML = txt
                }
            }
            else {
                if (!document.getElementById('Le1').innerHTML) {
                    let best_drink = set_price(
                        min_price=safe_int(document.getElementById('drink_fw_0').value),
                        max_price=safe_int(document.getElementById('drink_fw_1').value),
                        stocks=[safe_int(document.getElementById('drink_stock_0').innerHTML), safe_int(document.getElementById('drink_stock_1').innerHTML),
                                safe_int(document.getElementById('drink_stock_2').innerHTML)],
                        prices=[0, safe_int(document.getElementById('drink_dt_0').value), safe_int(document.getElementById('drink_dt_1').value)],
                        bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                    )
                    let best_food = set_price(
                        min_price=safe_int(document.getElementById('food_fw_0').value),
                        max_price=safe_int(document.getElementById('food_fw_1').value),
                        stocks=[safe_int(document.getElementById('food_stock_0').innerHTML), safe_int(document.getElementById('food_stock_1').innerHTML), safe_int(document.getElementById('food_stock_2').innerHTML)],
                        prices=[0, safe_int(document.getElementById('food_dt_0').value), safe_int(document.getElementById('food_dt_1').value)],
                        bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                    )
                    if (best_drink.length < 3 || best_drink[2] + best_drink[3] <= 0.01) {
                        txt_big = "请给饮品定价并售卖，然后点击“开始计算”进入下一步"
                        txt = `定价${best_drink[0]}，预计收益为${best_drink[1]}`
                        document.getElementById('Le1').innerHTML = txt
                        minus = 0
                    }
                    else {
                        let next_step_gain = best_drink.slice(2)
                        let food_gain = best_food.slice(2)
                        let toy_ = toy_benefit(
                            safe_int(document.getElementById('toy_fw_0').value),
                            safe_int(document.getElementById('toy_fw_1').value),
                            [safe_int(document.getElementById('toy_stock_0').innerHTML), safe_int(document.getElementById('toy_stock_1').innerHTML)]
                        )
                        let toy_gain = [toy_[0] - toy_[1]]
                        for (let q = 0; q < detect_time; q++) {
                            next_step_gain.push(0)
                            food_gain.push(0)
                            toy_gain.push(0)
                        }
                        let best_strat = best_strategy([next_step_gain, food_gain, toy_gain], detect_time)
                        console.log(best_strat)
                        if (best_strat[0][0] > 0) {
                            if (safe_int(document.getElementById('drink_dt_0').value) == 0 && safe_int(document.getElementById('drink_dt_1').value) == 0) {
                                txt_big = "请打探一次饮品售价并在输入框中输入，然后点击“开始计算”"
                            }
                            else {
                                txt_big = `请<span><b>再</b></span>打探一次饮品售价并在输入框中输入，然后点击“开始计算”`
                            }
                        }
                        else {
                            txt_big = "请给饮品定价并售卖，然后点击“开始计算”进入下一步"
                            txt = `定价${best_drink[0]}，预计收益为${best_drink[1]}`
                            document.getElementById('Le1').innerHTML = txt
                            minus = 0
                        }
                    }
                }
                else if (!document.getElementById('Le2').innerHTML) {
                    let best_food = set_price(
                        min_price=safe_int(document.getElementById('food_fw_0').value),
                        max_price=safe_int(document.getElementById('food_fw_1').value),
                        stocks=[safe_int(document.getElementById('food_stock_0').innerHTML), safe_int(document.getElementById('food_stock_1').innerHTML), safe_int(document.getElementById('food_stock_2').innerHTML)],
                        prices=[0, safe_int(document.getElementById('food_dt_0').value), safe_int(document.getElementById('food_dt_1').value)],
                        bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                    )
                    if (best_food.length < 3 || best_food[2] + best_food[3] <= 0.01) {
                        txt_big = "请给食品定价并售卖，然后点击“开始计算”进入下一步"
                        txt = `定价${best_food[0]}，预计收益为${best_food[1]}`
                        document.getElementById('Le2').innerHTML = txt
                        minus = 0
                    }
                    else {
                        let next_step_gain = best_food.slice(2)
                        let toy_ = toy_benefit(
                            safe_int(document.getElementById('toy_fw_0').value),
                            safe_int(document.getElementById('toy_fw_1').value),
                            [safe_int(document.getElementById('toy_stock_0').innerHTML), safe_int(document.getElementById('toy_stock_1').innerHTML)]
                        )
                        let toy_gain = [toy_[0] - toy_[1]]
                        for (let q = 0; q < detect_time; q++) {
                            next_step_gain.push(0)
                            toy_gain.push(0)
                        }
                        let best_strat = best_strategy([next_step_gain, toy_gain], detect_time)
                        if (best_strat[0][0] > 0) {
                            if (safe_int(document.getElementById('food_dt_0').value) == 0 && safe_int(document.getElementById('food_dt_1').value) == 0) {
                                txt_big = "请打探一次食品售价并在输入框中输入，然后点击“开始计算”"
                            }
                            else {
                                txt_big = `请<span><b>再</b></span>打探一次食品售价并在输入框中输入，然后点击“开始计算”`
                            }
                        }
                        else {
                            txt_big = "请给食品定价并售卖，然后点击“开始计算”进入下一步"
                            txt = `定价${best_food[0]}，预计收益为${best_food[1]}`
                            document.getElementById('Le2').innerHTML = txt
                            minus = 0
                        }
                    }
                }
                else if (!document.getElementById('Le3').innerHTML) {
                    txt_big = "请打探一次纪念品售价并在输入框中输入，然后点击“开始计算”"
                    minus = -detect_time
                }
            }
            document.getElementById('detect').value = Math.max(0, parseInt(detect_time) + parseInt(minus))
            document.getElementById('L8').innerHTML = txt_big
        }

        function choose_strat(inprice=[30, 42, 57], stock=360, strat=[0, 0, 0], outprice=[95, 105], detects=0) {
            C++
            // console.log('choose_strat', C)
            // console.log(inprice, stock, strat, outprice, detects)
            let max_earn = 0
            let best = -1
            let total_possib = 9
            let range1 = [0, 1, 2]
            let range2 = [0, 1, 2]
            if (strat[1] >= 0) {
                range1 = [strat[1]]
                total_possib /= 3
            }
            if (strat[2] >= 0) {
                range2 = [strat[2]]
                total_possib /= 3
            }
            let judge_active = false
            if (strat[1] < 0 && strat[2] < 0) {
                judge_active = true
            }
            let a = [
                [
                    [0, 0, 0], [0, 0, 0], [0, 0, 0]
                ],
                [
                    [0, 0, 0], [0, 0, 0], [0, 0, 0]
                ],
                [
                    [0, 0, 0], [0, 0, 0], [0, 0, 0]
                ]
            ]
            for (let i = 0; i < 3; i++) {
                let total_earn = 0
                for (let ri1 = 0; ri1 < range1.length; ri1++) {
                    let strat1 = range1[ri1]
                    for (let ri2 = 0; ri2 < range2.length; ri2++) {
                        let strat2 = range2[ri2]
                        let total_earn_multiplier = 1
                        if (judge_active && strat2 > strat1) {
                            continue
                        }
                        else if (judge_active && strat2 < strat1) {
                            total_earn_multiplier = 2
                        }
                        let pct = percentages([-i, -strat1, -strat2])
                        let cost = pct[0] * stock * inprice[i]
                        // console.log('i, strat1, strat2', i, strat1, strat2)
                        let earn = set_price(
                            outprice[0], outprice[1],
                            [pct[0] * stock, pct[1] * stock, pct[2] * stock],
                            [0, 0, 0], [5000, 2000, 1000]
                        )
                        let total = [earn[1] - cost, earn[2], earn[3]]
                        total_earn += sum(total.slice(0, 1 + detects))  * total_earn_multiplier
                        a[i][strat1][strat2] = sum(total.slice(0, 1 + detects))
                        if (judge_active && strat2 < strat1) {
                            a[i][strat2][strat1] = sum(total.slice(0, 1 + detects))
                        }
                    }
                }
                if (total_earn > max_earn) {
                    max_earn = total_earn
                    best = i
                }
            }
            let max_earn_not_detect = max_earn / total_possib
            // console.log('max_earn_not_detect, max_earn, total_possib', max_earn_not_detect, max_earn, total_possib)
            let avg_earn_2_detect = 0
            // console.log(strat)
            if (strat[1] < 0 || strat[2] < 0) {
                for (let j = 0; j < 3; j++) {
                    for (let k = 0; k < 3; k++) {
                        let max_earn = 0
                        for (let i = 0; i < 3; i++) {
                            if (a[i][j][k] > max_earn) {
                                max_earn = a[i][j][k]
                            }
                        }
                        // console.log('max_earn', max_earn)
                        avg_earn_2_detect += max_earn / total_possib
                    }
                }
                if (!(strat[1] < 0 && strat[2] < 0)) {
                    // console.log('max_earn_not_detect, avg_earn_2_detect - max_earn_not_detect', max_earn_not_detect, avg_earn_2_detect - max_earn_not_detect)
                    return [best, max_earn_not_detect, avg_earn_2_detect - max_earn_not_detect, 0]
                }
            }
            let avg_earn_1_detect = 0
            if (strat[1] < 0 && strat[2] < 0) {
                for (let j = 0; j < 3; j++) {
                    let big = 0
                    for (let i = 0; i < 3; i++) {
                        let avg = 0
                        for (let k = 0; k < 3; k++) {
                            avg += a[i][j][k]
                        }
                        if (avg > big) {
                            big = avg
                        }
                    }
                    avg_earn_1_detect += big / total_possib
                }
                // console.log('avg_earn_1_detect, max_earn_not_detect, avg_earn_2_detect, avg_earn_1_detect', avg_earn_1_detect, max_earn_not_detect, avg_earn_2_detect, avg_earn_1_detect)
                // console.log('best, max_earn_not_detect, avg_earn_1_detect - max_earn_not_detect, avg_earn_2_detect - avg_earn_1_detect', best, max_earn_not_detect, avg_earn_1_detect - max_earn_not_detect, avg_earn_2_detect - avg_earn_1_detect)
                return [best, max_earn_not_detect, avg_earn_1_detect - max_earn_not_detect, avg_earn_2_detect - avg_earn_1_detect]
            }
            // console.log('best, max_earn_not_detect', best, max_earn_not_detect)
            return [best, max_earn_not_detect, 0, 0]
        }

        function cal_jinhuo() {
            // 饮品
            let strats, pct, total_goods;
            strats = [-1, -1, -1]
            strats[0] = document.getElementById('drink_strat_0').value
            strats[1] = document.getElementById('drink_strat_1').value
            strats[2] = document.getElementById('drink_strat_2').value
            for (let i = 0; i < 3; i++) {
                if (strats[i] == -1) {
                    document.getElementById('L8').innerHTML = '必须填写完所有对手策略'
                    return
                }
            }
            pct = percentages([-strats[0], -strats[1], -strats[2]])
            total_goods = safe_int(document.getElementById('drink_total').value)
            for (let i = 0; i < 3; i++) {
                pct[i] = pct[i] * total_goods
                document.getElementById(`drink_stock_${i}`).innerHTML = pct[i]
            }
            // 食品
            strats = [-1, -1, -1]
            strats[0] = document.getElementById('food_strat_0').value
            strats[1] = document.getElementById('food_strat_1').value
            strats[2] = document.getElementById('food_strat_2').value
            for (let i = 0; i < 3; i++) {
                if (strats[i] == -1) {
                    document.getElementById('L8').innerHTML = '必须填写完所有对手策略'
                    return
                }
            }
            pct = percentages([-strats[0], -strats[1], -strats[2]])
            total_goods = safe_int(document.getElementById('food_total').value)
            for (let i = 0; i < 3; i++) {
                pct[i] = pct[i] * total_goods
                document.getElementById(`food_stock_${i}`).innerHTML = pct[i]
            }
            // 纪念品
            strats = [-1, -1, -1]
            strats[0] = document.getElementById('toy_strat_0').value
            strats[1] = document.getElementById('toy_strat_1').value
            for (let i = 0; i < 2; i++) {
                if (strats[i] == -1) {
                    document.getElementById('L8').innerHTML = '必须填写完所有对手策略'
                    return
                }
            }
            total_goods = safe_int(document.getElementById('toy_total').value)
            if (strats[1] < strats[0]) {
                document.getElementById(`toy_stock_0`).innerHTML = total_goods * 0.6
                document.getElementById(`toy_stock_1`).innerHTML = total_goods * 0.4
            }
            else if (strats[1] == strats[0]) {
                document.getElementById(`toy_stock_0`).innerHTML = total_goods * 0.5
                document.getElementById(`toy_stock_1`).innerHTML = total_goods * 0.5
            }
            else if (strats[1] > strats[0]) {
                document.getElementById(`toy_stock_1`).innerHTML = total_goods * 0.6
                document.getElementById(`toy_stock_0`).innerHTML = total_goods * 0.4
            }
            document.getElementById('L8').innerHTML = '进货数量计算完毕，请比对是否与游戏中显示一致，然后可以开始计算。'
            return
        }

        function determine_input_strategy(detects=0) {
            let strats_drink = [-1, -1, -1]
            strats_drink[0] = document.getElementById('drink_strat_0').value
            strats_drink[1] = document.getElementById('drink_strat_1').value
            strats_drink[2] = document.getElementById('drink_strat_2').value
            let strats_food = [-1, -1, -1]
            strats_food[0] = document.getElementById('food_strat_0').value
            strats_food[1] = document.getElementById('food_strat_1').value
            strats_food[2] = document.getElementById('food_strat_2').value
            let strats_toy = [-1, -1]
            strats_toy[0] = document.getElementById('toy_strat_0').value
            strats_toy[1] = document.getElementById('toy_strat_1').value
            let detect_time = safe_int(document.getElementById('detect').value)
            document.getElementById('L8').innerHTML = '进货策略计算完毕，请按提示进货，然后补全其他对手的进货策略，再计算进货数量并比对'
            
            let st1 = choose_strat(
                inprice=[safe_int(drink_buyin[0]), safe_int(drink_buyin[1]), safe_int(drink_buyin[2])],
                stock=safe_int(document.getElementById('drink_total').value),
                strat=strats_drink,
                outprice=[safe_int(document.getElementById('drink_fw_0').value), safe_int(document.getElementById('drink_fw_1').value)],
                detects=detects
            )[0]
            document.getElementById('drink_strat_0').value = st1
            let st2 = choose_strat(
                inprice=[safe_int(food_buyin[0]), safe_int(food_buyin[1]), safe_int(food_buyin[2])],
                stock=safe_int(document.getElementById('food_total').value),
                strat=strats_food,
                outprice=[safe_int(document.getElementById('food_fw_0').value), safe_int(document.getElementById('food_fw_1').value)],
                detects=detects
            )[0]
            document.getElementById('food_strat_0').value = st2
            if (strats_toy[1] == 0) {
                document.getElementById('toy_strat_0').value = 1
            }
            else {
                document.getElementById('toy_strat_0').value = 2
            }
            return
        }

        function first_phase_greedy() {
            let strats_drink = [-1, -1, -1]
            strats_drink[0] = document.getElementById('drink_strat_0').value
            strats_drink[1] = document.getElementById('drink_strat_1').value
            strats_drink[2] = document.getElementById('drink_strat_2').value
            let strats_food = [-1, -1, -1]
            strats_food[0] = document.getElementById('food_strat_0').value
            strats_food[1] = document.getElementById('food_strat_1').value
            strats_food[2] = document.getElementById('food_strat_2').value
            let strats_toy = [-1, -1]
            strats_toy[0] = document.getElementById('toy_strat_0').value
            strats_toy[1] = document.getElementById('toy_strat_1').value
            let detect_time = safe_int(document.getElementById('detect').value)
            console.log('剩余打探次数', detect_time)
            if (detect_time <= 0) {
                determine_input_strategy(0)
                return
            }
            else if (strats_drink[1] >= 0 && strats_drink[2] >= 0 && strats_food[1] >= 0 && strats_food[2] >= 0 && strats_toy[1] >= 0) {
                determine_input_strategy(Math.min(2, Math.floor(detect_time / 2)))
                return
            }
            else if (strats_drink[1] >= 0 || strats_drink[2] >= 0 || strats_food[1] >= 0 || strats_food[2] >= 0 || strats_toy[1] >= 0) {
                determine_input_strategy(Math.min(2, Math.floor(detect_time / 2)))
                return
            }
            let max_earn = 0
            let best_strat = [-1, -1, -1]
            console.time('计算一阶段打探收益')
            let drink_buy_strat = choose_strat(
                inprice=[safe_int(drink_buyin[0]), safe_int(drink_buyin[1]), safe_int(drink_buyin[2])],
                stock=safe_int(document.getElementById('drink_total').value),
                strat=[-1, -1, -1],
                outprice=[safe_int(document.getElementById('drink_fw_0').value), safe_int(document.getElementById('drink_fw_1').value)],
                detects=1
            ).slice(2)
            // console.log('drink_buy_strat', drink_buy_strat)
            let food_buy_strat = choose_strat(
                inprice=[safe_int(food_buyin[0]), safe_int(food_buyin[1]), safe_int(food_buyin[2])],
                stock=safe_int(document.getElementById('food_total').value),
                strat=[-1, -1, -1],
                outprice=[safe_int(document.getElementById('food_fw_0').value), safe_int(document.getElementById('food_fw_1').value)],
                detects=1
                ).slice(2)
            // console.log('food_buy_strat', food_buy_strat)
            console.timeEnd('计算一阶段打探收益')
            console.time('计算二阶段打探收益')
            let toy_buy_strat = [20 * safe_int(document.getElementById('toy_total').value), 0]
            let p = [0, 0, 0, 0, 0, 0, 0, 0]
            p[1] = [3 / 27, [1 / 3, 1 / 3, 1 / 3]]
            p[2] = [2 / 27, [2 / 9, 3 / 9, 4 / 9]]
            p[4] = [2 / 27, [4 / 9, 3 / 9, 2 / 9]]
            p[3] = [2 / 27, [3 / 9, 4 / 9, 2 / 9]]
            p[0] = [3 / 27, [4 / 10, 3 / 10, 3 / 10]]
            p[5] = [6 / 27, [4 / 10, 4 / 10, 2 / 10]]
            p[6] = [3 / 27, [2 / 10, 4 / 10, 4 / 10]]
            p[7] = [6 / 27, [3 / 10, 3 / 10, 4 / 10]]
            let food_sell_strat = [0, 0]
            let drink_sell_strat = [0, 0]
            let toy_sell_strat = [0, 0]
            for (let i = 0; i < p.length; i++) {
                let stocks = [0, 0, 0]
                for (let j = 0; j < 3; j++) {
                    stocks[j] = p[i][1][j] * safe_int(document.getElementById('drink_total').value)
                }
                let dss = set_price(
                    min_price=safe_int(document.getElementById('drink_fw_0').value),
                    max_price=safe_int(document.getElementById('drink_fw_1').value),
                    stocks=stocks,
                    prices=[0, 0, 0],
                    bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                )
                drink_sell_strat[0] += dss[2] * p[i][0]
                drink_sell_strat[1] += dss[3] * p[i][0]
                // console.log('i, p[i], drink_sell_strat', i, p[i], drink_sell_strat)

                for (let j = 0; j < 3; j++) {
                    stocks[j] = p[i][1][j] * safe_int(document.getElementById('food_total').value)
                }
                let fss = set_price(
                    min_price=safe_int(document.getElementById('food_fw_0').value),
                    max_price=safe_int(document.getElementById('food_fw_1').value),
                    stocks=stocks,
                    prices=[0, 0, 0],
                    bonus=[safe_int(document.getElementById('bonus_1').value), safe_int(document.getElementById('bonus_2').value), safe_int(document.getElementById('bonus_3').value)],
                )
                food_sell_strat[0] += fss[2] * p[i][0]
                food_sell_strat[1] += fss[3] * p[i][0]
            }
            toy_sell_strat[0] = 1 / 3 * 50 * safe_int(document.getElementById('toy_total').value) * 0.5 + 2 / 3 * 450 / 11 * safe_int(document.getElementById('toy_total').value) * 0.6
            // console.log('drink_buy_strat', drink_buy_strat)
            // console.log('food_buy_strat', food_buy_strat)
            // console.log('toy_buy_strat', toy_buy_strat)
            // console.log('drink_sell_strat', drink_sell_strat)
            // console.log('food_sell_strat', food_sell_strat)
            // console.log('toy_sell_strat', toy_sell_strat)
            console.timeEnd('计算二阶段打探收益')
            console.time('穷举策略')
            for (let a = 0; a < 3; a++) {
                for (let b = 0; b < 3; b++) {
                    for (let c = 0; c < 2; c++) {
                        for (let d = 0; d < 3; d++) {
                            for (let e = 0; e < 3; e++) {
                                for (let f = 0; f < 2; f++) {
                                    if (a + b + c + d + e + f != detect_time) {
                                        continue
                                    }
                                    let tot = 0
                                    tot += sum(drink_buy_strat.slice(0, a))
                                    tot += sum(food_buy_strat.slice(0, b))
                                    tot += sum(toy_buy_strat.slice(0, c))
                                    tot += sum(drink_sell_strat.slice(0, d))
                                    tot += sum(food_sell_strat.slice(0, e))
                                    tot += sum(toy_sell_strat.slice(0, f))
                                    if (tot > max_earn) {
                                        max_earn = tot
                                        best_strat = [a, b, c]
                                    }
                                }
                            }
                        }
                    }
                }
            }
            console.timeEnd('穷举策略')
            // console.log(max_earn, best_strat)
            if (sum(best_strat) > 0) {
                document.getElementById('L8').innerHTML = `打探饮品进货${best_strat[0]}次，打探食品进货${best_strat[1]}次，打探纪念品进货${best_strat[2]}次，然后输入打探结果并再次点击此按钮`
                document.getElementById('detect').value = Math.max(0, detect_time - sum(best_strat))
            }
            else {
                determine_input_strategy(Math.min(2, Math.floor(detect_time / 2)))
            }
        }

        function reset_calc() {
            document.getElementById('Le1').innerHTML = ''
            document.getElementById('Le2').innerHTML = ''
            document.getElementById('Le3').innerHTML = ''
            document.getElementById('detect').value = 0
            document.getElementById('L8').innerHTML = '这里显示计算结果'
        }

        // 页面加载完成时执行
        console.log('OK')
        
    </script>
</body>
</html>